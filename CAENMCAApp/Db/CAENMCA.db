record(waveform, "$(P)$(Q)TITLE")
{
    field(DESC, "Run title")
    field(NELM, "256")
    field(FTVL, "CHAR")
    field(DTYP, "asynOctetRead")
    field(INP,  "@asyn($(PORT),0,0)RUNTITLE")
    field(SCAN, "I/O Intr")
    info(INTEREST, "HIGH")
    info(archive, "VAL")
}

record(waveform, "$(P)$(Q)TITLE:SP")
{
    field(DESC, "Set Run title")
    field(NELM, "256")
    field(FTVL, "CHAR")
    field(DTYP, "asynOctetWrite")
    field(INP,  "@asyn($(PORT),0,0)RUNTITLE")
    field(PINI, "YES")
    info(autosaveFields, "VAL")
}

record(waveform, "$(P)$(Q)COMMENTS")
{
    field(DESC, "Run comments")
    field(NELM, "512")
    field(FTVL, "CHAR")
    field(DTYP, "asynOctetRead")
    field(INP,  "@asyn($(PORT),0,0)RUNCOMMENT")
    field(SCAN, "I/O Intr")
    info(INTEREST, "HIGH")
    info(archive, "VAL")
}

record(waveform, "$(P)$(Q)COMMENTS:SP")
{
    field(DESC, "Set Run comment")
    field(NELM, "256")
    field(FTVL, "CHAR")
    field(DTYP, "asynOctetWrite")
    field(INP,  "@asyn($(PORT),0,0)RUNCOMMENT")
    field(PINI, "YES")
    info(autosaveFields, "VAL")
}

record(lso, "$(P)$(Q)USERNAME")
{
    field(OMSL, "closed_loop")
    field(DESC, "Experiment User Surnames")
	field(DTYP, "asynOctetWrite")
    field(OUT, "@asyn($(PORT),0,0)USERNAME")
	field(DOL, "$(P)ED:USERNAME:DAE:SP CP")
    field(SIZV, "1024")
	info(autosaveFields, "VAL")
}

record(stringout, "$(P)$(Q)RBNUMBER")
{
    field(DESC, "Experiment (RB) Number")
    field(OMSL, "closed_loop")
	field(DOL, "$(P)ED:RBNUMBER CP")
    field(DTYP, "asynOctetWrite")
    field(OUT, "@asyn($(PORT),0,0)RBNUMBER")
	info(autosaveFields, "VAL")
}

record(stringin, "$(P)$(Q)RUNNUMBER")
{
    field(DESC, "Run Number")
    field(DTYP, "asynOctetRead")
    field(INP,  "@asyn($(PORT),0,0)RUNNUMBER")
    field(VAL, "0")
    field(SCAN, "I/O Intr")
    info(INTEREST, "HIGH")
    info(archive, "VAL")
}

record(longin, "$(P)$(Q)IRUNNUMBER")
{
    field(DESC, "Run Number")
    field(DTYP, "asynInt32")
    field(INP,  "@asyn($(PORT),0,0)IRUNNUMBER")
    field(SCAN, "I/O Intr")
    info(INTEREST, "MEDIUM")
	info(archive, "VAL")
	field(EGU, "")
}

# save last run number
record(longout, "$(P)$(Q)_IRUNNUMBER")
{
    field(DESC, "Run Number")
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn($(PORT),0,0)IRUNNUMBER")
	field(EGU, "")
    field(PINI, "YES")
    info(autosaveFields_pass0, "VAL") # use positions/pass0 as saved more frequently
    info(asyn:READBACK, "1") # needed as we increment run number in driver code
}

record(stringin, "$(P)$(Q)FILEPREFIX")
{
    field(DESC, "File Prefix")
    field(DTYP, "asynOctetRead")
    field(INP,  "@asyn($(PORT),0,0)FILEPREFIX")
    field(SCAN, "I/O Intr")
    info(INTEREST, "HIGH")
    info(autosaveFields, "VAL")
}

record(stringout, "$(P)$(Q)FILEPREFIX:SP")
{
    field(DESC, "File Prefix")
    field(DTYP, "asynOctetWrite")
    field(OUT,  "@asyn($(PORT),0,0)FILEPREFIX")
    field(PINI, "YES")
    info(INTEREST, "HIGH")
    info(autosaveFields, "VAL")
}

record(bo, "$(P)$(Q)BEGINALL:SP")
{
    field(DESC, "Begin all hexagons")
    field(ZNAM, "0")
    field(ONAM, "1")
    #Set the initial alarm state
    field(UDFS, "NO_ALARM")
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn($(PORT),0,0)BEGINRUNALL")
    field(FLNK, "$(P)$(Q)SYNCDAE:BEGIN.PROC CA")
}
alias("$(P)$(Q)BEGINALL:SP", "$(P)$(Q)BEGINALL:SP_")

record(bo, "$(P)$(Q)ABORTALL:SP")
{
    field(DESC, "Abort all hexagons")
    field(ZNAM, "0")
    field(ONAM, "1")
    #Set the initial alarm state
    field(UDFS, "NO_ALARM")
    field(FLNK, "$(P)$(Q)ABORTALL:SP_")
}

record(event, "$(P)$(Q)ABORTALL:SP_")
{
    field(DESC, "Abort all hexagons")
    field(VAL, "AbortRun")
    field(FLNK, "$(P)$(Q)SYNCDAE:ABORT.PROC CA")
}

record(bo, "$(P)$(Q)ENDALL:SP")
{
    field(DESC, "End all hexagons")
    field(ZNAM, "0")
    field(ONAM, "1")
    #Set the initial alarm state
    field(UDFS, "NO_ALARM")
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn($(PORT),0,0)ENDRUNALL")
    field(FLNK, "$(P)$(Q)SYNCDAE:END.PROC CA")
}
alias("$(P)$(Q)ENDALL:SP", "$(P)$(Q)ENDALL:SP_")

record(seq, "$(P)$(Q)ENDBEGALL:SP")
{
    field(SELM, "All")
    field(LNK0, "$(P)$(Q)ENDALL:SP PP")
    field(DLY1, "1")
    field(LNK1, "$(P)$(Q)BEGINALL:SP PP")
}

# This must be less that 2048 MB (2GB) and enough
# less to catch it and allow an end/begin to be executed
# automatically
record(ao, "$(P)$(Q)LISTFILE:SIZE:MAX:SP")
{
    field(VAL, "2000")
    field(EGU, "MB")
    field(DESC, "Max list file size")
    field(PINI, "YES")
    info(autosaveFields, "VAL")
}
